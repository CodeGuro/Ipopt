# Copyright (C) 2007 Peter Carbonetto. All Rights Reserved.
# This code is published under the Common Public License.
#
# Author: Peter Carbonetto
#         Dept. of Computer Science
#         University of British Columbia
#         May 19, 2007

# You should only have to adapt the first two variable definitions:

# Here you need to speficy the base directory of your matlab installation.
# This is the directory so that in its 'bin/' subdirectory you see all the
# matlab executables (such as 'matlab', 'mex', etc.)
MATLAB_HOME   = /usr/local/R2006b

# Set the suffix for matlab mex files.
# The content of the $(MATLAB_HOME)/extern/examples/mex directory might
# be able to help you.
MEXSUFFIX     = mexglx    # Linux 32bit
#MEXSUFFIX     = mexmac    # Mac OS X settings

#############################################################################
# Everything below here should be correct

CXX           = @CXX@
CXXFLAGS      = @CXXFLAGS@

IPOPT_INCLUDE = -I@includedir@
IPOPTLIBDIR   = @libdir@
exec_prefix   = @exec_prefix@
prefix        = @prefix@
LIBS          = @ipoptlib@ @ADDLIBS@

MEX           = mex

TARGET = ipopt.$(MEXSUFFIX)

OBJS   = matlabexception.@OBJEXT@ matlabscalar.@OBJEXT@ matlabstring.@OBJEXT@ matlabjournal.@OBJEXT@ \
         matlabmatrix.@OBJEXT@ arrayofmatrices.@OBJEXT@ sparsematrix.@OBJEXT@ matlabprogram.@OBJEXT@ \
         matlaboption.@OBJEXT@ ipopt.@OBJEXT@

MATLAB_INCLUDE = -I$(MATLAB_HOME)/extern/include
INCLUDE        = $(IPOPT_INCLUDE) $(MATLAB_INCLUDE) 
CXXFLAGS       += -DMATLAB_MEXFILE #-DMWINDEXISINT
CXXOPTIMFLAGS  = $(CXXFLAGS)
LDOPTIMFLAGS   = $(CXXFLAGS) @RPATH_FLAGS@
MEXFLAGS       = -v -cxx -O CXX="$(CXX)" CXXOPTIMFLAGS="$(CXXOPTIMFLAGS)" LDOPTIMFLAGS="$(LDOPTIMFLAGS)" LD="$(CXX)"

SRCDIR = @srcdir@
VPATH = $(SRCDIR)

all: install

%.@OBJEXT@: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDE) -o $@ -c $^

$(TARGET): $(OBJS)
	$(MEX) $(MEXFLAGS) $(LIBS) -output $@ $^

install: $(TARGET)
	cp $(TARGET) ..

clean:
	rm -f $(OBJS) $(TARGET)

